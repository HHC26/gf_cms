/** * Created by apple on 2018/9/8. */layui.extend({    admin: '{/}../../static/admin/js/admin'});layui.use(['table', 'jquery','form', 'admin', 'laydate'], function() {    var table = layui.table,        $ = layui.jquery,        form = layui.form,        admin = layui.admin;    //监听submit    form.on('submit(add)', function(data){        //console.log(data.elem) //被执行事件的元素DOM对象，一般为button对象        //console.log(data.form) //被执行提交的form对象，一般在存在form标签时才会返回        //console.log(data.field) //当前容器的全部表单字段，名值对形式：{name: value}        if(data.field.channel_name==''){            layer.msg('请输入分类名称',{icon:5,anim:6,time:2000});        }else{            $.post('add.html',data.field,function (res) {                if(res['code']==1){                    //添加成功                    layer.msg(res['msg'],{icon:6,time:1000},function () {                        table.reload('adschannel', {                            url: location.href                            ,where: {} //设定异步数据接口的额外参数                            //,height: 300                        });                    });                }else{                    //添加失败                    layer.msg(res['msg'],{icon:5,time:2000});                }            });        }        return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。    });    table.render({        elem: '#adschannel',        cellMinWidth: 60,        url:location.href,        cols: [            [{                field: 'id',title: '分类ID', sort: true            }, {                field: 'channel_name',title: '分类名称',templet: '#usernameTpl'            }, {                field: 'remarks',title: '备注',width:'60%'            }, {                field: 'sort',title: '排序',templet:'<div style="line-height: 60px;"><input style="height:28px;" lay-verify="required" autocomplete="off" class="layui-input sort" id="sort_{{ d.id }}" data-id="{{ d.id }}" type="number" value="{{ d.sort }}"></div>'            }, {                field: 'operate',title: '操作',toolbar: '#operateTpl',unresize: true            }]        ],        event: true,        page: {            layout: ['prev','next','page','count','skip','limit'] //自定义分页布局            //,curr: 5 //设定初始在第 5 页            ,groups: 5 //只显示 N 个连续页码            ,first: false //不显示首页            ,last: false //不显示尾页        },    });    //console.table(res);    /*     *数据表格中form表单元素是动态插入,所以需要更新渲染下     * http://www.layui.com/doc/modules/form.html#render     * */    $(function(){        //form.render();    });    /*单个删除*/    window.member_del = function(obj, id) {        layer.confirm('确认要删除吗？', function(index) {            //发异步删除数据            $.post('del.html',{'adschannelid':id},function (res) {                if(res['code']==1){                    //删除成功                    layer.msg(res['msg'], {                        icon: 6,                        time: 1000,                        end: function () {                            //重载当前页码的表格数据                            var nowPage = $('.layui-laypage-skip>.layui-input').val();                            table.reload('adschannel', {                                url: location.href                                ,where: {} //设定异步数据接口的额外参数                                ,page: {                                    curr: nowPage //重新从第 N 页开始                                }                                //,height: 300                            });                        }                    });                }else{                    //删除失败                    layer.msg(res['msg'], {                        icon: 5,                        time: 2000                    });                }            });        });    },    /*排序*/    window.Sort = function(){        var arr = new Array();        var work = false;        $('.sort').each(function(){            if( $(this).val()=='' ){                layer.tips('不能为空', '#sort_'+$(this).attr('data-id'), {                    tips: [4, '#78BA32']                    ,tipsMore: false                });                work = false;                return false;            }else if( $(this).val()<0 ){                layer.tips('必须为大于等于0的数字', '#sort_'+$(this).attr('data-id'), {                    tips: [4, '#78BA32']                    ,tipsMore: false                });                work = false;                return false;            }else{                arr.push({'id':$(this).attr('data-id'),'sort':$(this).val()});                work = true;            }        });        if(work == true){            $.post('sort.html',{'data':arr},function (res) {                if(res['code']==1){                    layer.msg('更新排序成功',{icon:6,time:1000},function () {                        self.location.reload();                    });                }else{                    layer.msg(res['msg'],{icon:5,time:2000});                }            },'json');        }    }});